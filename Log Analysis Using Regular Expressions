
#!/usr/bin/env python3

import sys
import csv
import operator
import re

error = {}
per_user = {}

file = open("syslog.log", "r")

for line in file.readlines():
 if re.search(r"ticky: INFO: ([\w]*) ", line):
  per_user[line] = per_user.get(line, 0)+1
 elif re.search(r"ticky: ERROR: ([\w ]*) ", line):
  error[line] = error.get(line, 0)+1

file.close()

sorted_error_messages = sorted(error.items(), key=operator.itemgetter(1), reverse = True)
sorted_user_statistics = sorted(per_user.items(), key=operator.itemgetter(0))

# Insert column names in sorted_error_messages
sorted_error_messages.insert(0, ("Error", "Count"))

# Insert column names in sorted_user_statistics
sorted_user_statistics.insert(0, ("Username", "INFO", "ERROR"))

# Create error_messages.csv report
with open("error_message.csv", "w", newline="") as file:
    writer = csv.writer(file)
    writer.writerows(sorted_error_messages)

# Create user_statistics.csv report
with open("user_statistics.csv", "w", newline="") as file:
    writer = csv.writer(file)
    writer.writerows(sorted_user_statistics)


